<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="UnWrk - Focus timer with binaural beats for deep work">
    <meta name="theme-color" content="#6366f1">
    <title>UnWrk - Do less, achieve more</title>
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="icon-192.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif; 
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes bounce {
            0%, 100% {
                transform: translateY(-25%);
                animation-timing-function: cubic-bezier(0.8, 0, 1, 1);
            }
            50% {
                transform: translateY(0);
                animation-timing-function: cubic-bezier(0, 0, 0.2, 1);
            }
        }
        .animate-bounce {
            animation: bounce 1s infinite;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker error:', err));
            });
        }
    </script>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide icons as SVG components
        const Play = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const Pause = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );

        const RotateCcw = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const Plus = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const TrendingUp = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Award = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="8" r="7"></circle>
                <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
            </svg>
        );

        const Calendar = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Settings = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m8.66-15.66l-4.24 4.24m-4.24 4.24l-4.24 4.24M23 12h-6m-6 0H1m20.66 8.66l-4.24-4.24m-4.24-4.24l-4.24-4.24"></path>
            </svg>
        );

        const Volume2 = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
            </svg>
        );

        const VolumeX = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                <line x1="23" y1="9" x2="17" y2="15"></line>
                <line x1="17" y1="9" x2="23" y2="15"></line>
            </svg>
        );

        const X = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const Check = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        // Audio Engine
        const AudioEngine = {
            audioContext: null,
            oscillators: [],
            gainNodes: [],
            noiseNode: null,
            
            init() {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
            },
            
            stop() {
                this.oscillators.forEach(osc => {
                    try { osc.stop(); } catch(e) {}
                });
                this.oscillators = [];
                this.gainNodes = [];
                if (this.noiseNode) {
                    try { this.noiseNode.disconnect(); } catch(e) {}
                    this.noiseNode = null;
                }
            },
            
            createBinauralBeat(baseFreq, beatFreq, volume = 0.3) {
                this.init();
                this.stop();
                
                const leftOsc = this.audioContext.createOscillator();
                const rightOsc = this.audioContext.createOscillator();
                const leftGain = this.audioContext.createGain();
                const rightGain = this.audioContext.createGain();
                const merger = this.audioContext.createChannelMerger(2);
                const masterGain = this.audioContext.createGain();
                
                leftOsc.frequency.value = baseFreq;
                rightOsc.frequency.value = baseFreq + beatFreq;
                leftGain.gain.value = volume;
                rightGain.gain.value = volume;
                masterGain.gain.value = 1;
                
                leftOsc.connect(leftGain);
                rightOsc.connect(rightGain);
                leftGain.connect(merger, 0, 0);
                rightGain.connect(merger, 0, 1);
                merger.connect(masterGain);
                masterGain.connect(this.audioContext.destination);
                
                leftOsc.start();
                rightOsc.start();
                
                this.oscillators.push(leftOsc, rightOsc);
                this.gainNodes.push(leftGain, rightGain, masterGain);
            },
            
            createWhiteNoise(volume = 0.15) {
                this.init();
                this.stop();
                
                const bufferSize = 2 * this.audioContext.sampleRate;
                const noiseBuffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const output = noiseBuffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    output[i] = Math.random() * 2 - 1;
                }
                
                const whiteNoise = this.audioContext.createBufferSource();
                whiteNoise.buffer = noiseBuffer;
                whiteNoise.loop = true;
                
                const gainNode = this.audioContext.createGain();
                gainNode.gain.value = volume;
                
                whiteNoise.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                whiteNoise.start();
                
                this.noiseNode = whiteNoise;
                this.gainNodes.push(gainNode);
            },
            
            createBrownNoise(volume = 0.2) {
                this.init();
                this.stop();
                
                const bufferSize = 2 * this.audioContext.sampleRate;
                const noiseBuffer = this.audioContext.createBuffer(1, bufferSize, this.audioContext.sampleRate);
                const output = noiseBuffer.getChannelData(0);
                
                let lastOut = 0.0;
                for (let i = 0; i < bufferSize; i++) {
                    const white = Math.random() * 2 - 1;
                    output[i] = (lastOut + (0.02 * white)) / 1.02;
                    lastOut = output[i];
                    output[i] *= 3.5;
                }
                
                const brownNoise = this.audioContext.createBufferSource();
                brownNoise.buffer = noiseBuffer;
                brownNoise.loop = true;
                
                const gainNode = this.audioContext.createGain();
                gainNode.gain.value = volume;
                
                brownNoise.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                brownNoise.start();
                
                this.noiseNode = brownNoise;
                this.gainNodes.push(gainNode);
            },
            
            createMeditationTone(volume = 0.2) {
                this.init();
                this.stop();
                
                const frequencies = [432, 540, 648];
                const gains = [volume, volume * 0.5, volume * 0.3];
                
                frequencies.forEach((freq, i) => {
                    const osc = this.audioContext.createOscillator();
                    const gain = this.audioContext.createGain();
                    
                    osc.type = 'sine';
                    osc.frequency.value = freq;
                    gain.gain.value = gains[i];
                    
                    osc.connect(gain);
                    gain.connect(this.audioContext.destination);
                    osc.start();
                    
                    this.oscillators.push(osc);
                    this.gainNodes.push(gain);
                });
            }
        };

        // Backend simulation
        const Backend = {
            storage: {
                sessions: [],
                tasks: [],
                user: {
                    streak: 0,
                    totalSessions: 0,
                    lastSessionDate: null,
                    isPremium: false,
                    email: null,
                    settings: {
                        focusDuration: 25,
                        shortBreak: 5,
                        longBreak: 15,
                        sessionsBeforeLongBreak: 4,
                        smartSuggestion: true,
                        softBlocking: true,
                        ambientSound: true,
                        darkMode: false,
                        focusSound: 'none',
                        breakSound: 'none'
                    }
                }
            },
            
            async saveSession(session) {
                this.storage.sessions.push(session);
                this.storage.user.totalSessions++;
                this.updateStreak();
                return session;
            },
            
            updateStreak() {
                const today = new Date().toDateString();
                const lastDate = this.storage.user.lastSessionDate;
                
                if (lastDate === today) return;
                
                if (lastDate === new Date(Date.now() - 86400000).toDateString()) {
                    this.storage.user.streak++;
                } else if (lastDate !== today) {
                    this.storage.user.streak = 1;
                }
                
                this.storage.user.lastSessionDate = today;
            },
            
            getSmartSuggestion() {
                const recentSessions = this.storage.sessions.slice(-10);
                if (recentSessions.length < 3) return 25;
                
                const avgCompleted = recentSessions
                    .filter(s => s.completed)
                    .reduce((acc, s) => acc + s.duration, 0) / recentSessions.length;
                
                return Math.round(avgCompleted) || 25;
            },
            
            getAnalytics() {
                const sessions = this.storage.sessions;
                const completed = sessions.filter(s => s.completed);
                const efficiency = sessions.length > 0 ? (completed.length / sessions.length * 100) : 0;
                const totalMinutes = completed.reduce((acc, s) => acc + s.duration, 0);
                
                return {
                    efficiency: efficiency.toFixed(0),
                    totalMinutes,
                    weeklyForecast: Math.round(totalMinutes * 1.15),
                    bestTime: 'Morning'
                };
            }
        };

        function UnWrk() {
            const [mode, setMode] = useState('focus');
            const [timeLeft, setTimeLeft] = useState(25 * 60);
            const [isActive, setIsActive] = useState(false);
            const [sessionCount, setSessionCount] = useState(0);
            const [currentTask, setCurrentTask] = useState('');
            const [showTaskInput, setShowTaskInput] = useState(false);
            const [notes, setNotes] = useState([]);
            const [showNoteInput, setShowNoteInput] = useState(false);
            const [noteText, setNoteText] = useState('');
            const [view, setView] = useState('timer');
            const [darkMode, setDarkMode] = useState(false);
            const [settings, setSettings] = useState(Backend.storage.user.settings);
            const [suggestion, setSuggestion] = useState(25);
            const [showCelebration, setShowCelebration] = useState(false);
            const [soundEnabled, setSoundEnabled] = useState(false);
            const [selectedSound, setSelectedSound] = useState('none');
            const [showSoundMenu, setShowSoundMenu] = useState(false);
            const [showUpgradeModal, setShowUpgradeModal] = useState(false);
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [authEmail, setAuthEmail] = useState('');
            const [isPremium, setIsPremium] = useState(Backend.storage.user.isPremium);
            
            const intervalRef = useRef(null);
            const startTimeRef = useRef(null);

            const soundOptions = [
                { id: 'none', name: 'None', desc: 'Silent focus', free: true },
                { id: 'white', name: 'White Noise', desc: 'Full spectrum', free: true },
                { id: 'brown', name: 'Brown Noise', desc: 'Deep & calming', free: true },
                { id: 'meditation', name: 'Meditation', desc: 'Deep calm', free: true },
                { id: 'beta-8', name: 'Beta 8Hz', desc: 'Relaxed focus', free: false },
                { id: 'beta-18', name: 'Beta 18Hz', desc: 'Alert focus', free: false },
                { id: 'beta-34', name: 'Beta 34Hz', desc: 'Peak focus', free: false },
                { id: 'gamma-40', name: 'Gamma 40Hz', desc: 'Cognitive boost', free: false }
            ];

            useEffect(() => {
                setSuggestion(Backend.getSmartSuggestion());
            }, []);

            useEffect(() => {
                if (soundEnabled && selectedSound !== 'none') {
                    startSound(selectedSound);
                } else {
                    AudioEngine.stop();
                }
                
                return () => AudioEngine.stop();
            }, [soundEnabled, selectedSound]);

            useEffect(() => {
                if (isActive && timeLeft > 0) {
                    intervalRef.current = setInterval(() => {
                        setTimeLeft(prev => {
                            if (prev <= 1) {
                                handleSessionComplete();
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                } else {
                    clearInterval(intervalRef.current);
                }
                
                return () => clearInterval(intervalRef.current);
            }, [isActive, timeLeft]);

            const handleSessionComplete = async () => {
                setIsActive(false);
                setShowCelebration(true);
                
                const session = {
                    id: Date.now(),
                    taskDescription: currentTask,
                    notes,
                    startTime: startTimeRef.current,
                    endTime: new Date(),
                    duration: mode === 'focus' ? settings.focusDuration : 
                              mode === 'shortBreak' ? settings.shortBreak : settings.longBreak,
                    completed: true,
                    mode
                };
                
                await Backend.saveSession(session);
                
                setTimeout(() => setShowCelebration(false), 3000);
                
                if (mode === 'focus') {
                    const newCount = sessionCount + 1;
                    setSessionCount(newCount);
                    
                    if (newCount % settings.sessionsBeforeLongBreak === 0) {
                        switchMode('longBreak');
                    } else {
                        switchMode('shortBreak');
                    }
                } else {
                    switchMode('focus');
                }
            };

            const switchMode = (newMode) => {
                setMode(newMode);
                const durations = {
                    focus: settings.focusDuration * 60,
                    shortBreak: settings.shortBreak * 60,
                    longBreak: settings.longBreak * 60
                };
                setTimeLeft(durations[newMode]);
                setIsActive(false);
            };

            const toggleTimer = () => {
                if (!isActive && !currentTask && mode === 'focus') {
                    setShowTaskInput(true);
                    return;
                }
                
                if (!isActive) {
                    startTimeRef.current = new Date();
                    setDarkMode(true);
                    
                    if (mode === 'focus' && settings.focusSound !== 'none') {
                        setSelectedSound(settings.focusSound);
                        setSoundEnabled(true);
                    } else if ((mode === 'shortBreak' || mode === 'longBreak') && settings.breakSound !== 'none') {
                        setSelectedSound(settings.breakSound);
                        setSoundEnabled(true);
                    }
                } else {
                    setDarkMode(false);
                    setSoundEnabled(false);
                }
                
                setIsActive(!isActive);
            };

            const resetTimer = () => {
                setIsActive(false);
                setDarkMode(false);
                const durations = {
                    focus: settings.focusDuration * 60,
                    shortBreak: settings.shortBreak * 60,
                    longBreak: settings.longBreak * 60
                };
                setTimeLeft(durations[mode]);
            };

            const startSound = (soundType) => {
                const sound = soundOptions.find(s => s.id === soundType);
                if (!sound?.free && !isPremium) {
                    setShowUpgradeModal(true);
                    setSoundEnabled(false);
                    return;
                }
                
                switch(soundType) {
                    case 'white':
                        AudioEngine.createWhiteNoise(0.15);
                        break;
                    case 'brown':
                        AudioEngine.createBrownNoise(0.2);
                        break;
                    case 'beta-8':
                        AudioEngine.createBinauralBeat(200, 8, 0.25);
                        break;
                    case 'beta-18':
                        AudioEngine.createBinauralBeat(200, 18, 0.25);
                        break;
                    case 'beta-34':
                        AudioEngine.createBinauralBeat(200, 34, 0.25);
                        break;
                    case 'gamma-40':
                        AudioEngine.createBinauralBeat(200, 40, 0.25);
                        break;
                    case 'meditation':
                        AudioEngine.createMeditationTone(0.2);
                        break;
                    default:
                        AudioEngine.stop();
                }
            };

            const toggleSound = () => {
                if (!soundEnabled && selectedSound === 'none') {
                    setShowSoundMenu(true);
                } else {
                    setSoundEnabled(!soundEnabled);
                }
            };

            const addNote = () => {
                if (noteText.trim()) {
                    setNotes([...notes, { text: noteText, time: new Date() }]);
                    setNoteText('');
                    setShowNoteInput(false);
                }
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };

            const analytics = Backend.getAnalytics();
            const streak = Backend.storage.user.streak;
            const totalSessions = Backend.storage.user.totalSessions;

            const bgGradient = darkMode ? 'bg-slate-950' : 'bg-white';

            return (
                <div className={`min-h-screen ${bgGradient} transition-all duration-1000 relative overflow-hidden`}>
                    <div className="absolute inset-0 overflow-hidden pointer-events-none">
                        <div className={`absolute top-1/4 left-1/4 w-96 h-96 ${darkMode ? 'bg-purple-500/5' : 'bg-purple-200/20'} rounded-full blur-3xl animate-pulse`}></div>
                        <div className={`absolute bottom-1/4 right-1/4 w-96 h-96 ${darkMode ? 'bg-blue-500/5' : 'bg-blue-200/20'} rounded-full blur-3xl animate-pulse`} style={{animationDelay: '1s'}}></div>
                    </div>

                    {showCelebration && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm">
                            <div className="bg-white rounded-3xl p-12 text-center transform animate-bounce">
                                <div className="text-6xl mb-4">ðŸŽ‰</div>
                                <h2 className="text-3xl font-bold mb-2">Session Complete!</h2>
                                <p className="text-lg text-gray-600">
                                    {streak > 0 && `${streak} day streak! `}
                                    Keep going!
                                </p>
                            </div>
                        </div>
                    )}

                    <div className="relative z-10 max-w-md mx-auto px-6 py-8">
                        <div className="text-center mb-8 pt-4">
                            <h1 className={`text-4xl font-light tracking-widest ${darkMode ? 'text-white' : 'text-slate-800'}`}>
                                UnWrk
                            </h1>
                            <p className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'} mt-1 tracking-wide`}>
                                Do less, achieve more
                            </p>
                            {!isPremium && (
                                <button
                                    onClick={() => setShowAuthModal(true)}
                                    className="mt-4 text-xs px-4 py-2 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 text-white hover:scale-105 transition-transform shadow-lg"
                                >
                                    âœ¨ Upgrade to Premium
                                </button>
                            )}
                        </div>

                        <div className={`flex gap-2 mb-8 p-2 rounded-2xl ${darkMode ? 'bg-slate-800/50' : 'bg-white/50'} backdrop-blur-lg`}>
                            {['timer', 'analytics', 'settings'].map(v => (
                                <button
                                    key={v}
                                    onClick={() => setView(v)}
                                    className={`flex-1 py-3 rounded-xl transition-all ${
                                        view === v 
                                            ? darkMode ? 'bg-purple-600 text-white' : 'bg-indigo-600 text-white' 
                                            : darkMode ? 'text-slate-300 hover:bg-slate-700/50' : 'text-slate-700 hover:bg-white/50'
                                    }`}
                                >
                                    {v === 'timer' && <Calendar />}
                                    {v === 'analytics' && <TrendingUp />}
                                    {v === 'settings' && <Settings />}
                                </button>
                            ))}
                        </div>

                        {view === 'timer' && (
                            <div className="space-y-6">
                                <div className={`flex gap-2 p-2 rounded-2xl ${darkMode ? 'bg-slate-800/50' : 'bg-white/50'} backdrop-blur-lg`}>
                                    <button
                                        onClick={() => switchMode('focus')}
                                        className={`flex-1 py-2 rounded-xl text-sm transition-all ${
                                            mode === 'focus' ? 'bg-blue-500 text-white' : darkMode ? 'text-slate-300' : 'text-slate-700'
                                        }`}
                                    >
                                        Focus
                                    </button>
                                    <button
                                        onClick={() => switchMode('shortBreak')}
                                        className={`flex-1 py-2 rounded-xl text-sm transition-all ${
                                            mode === 'shortBreak' ? 'bg-green-500 text-white' : darkMode ? 'text-slate-300' : 'text-slate-700'
                                        }`}
                                    >
                                        Short Break
                                    </button>
                                    <button
                                        onClick={() => switchMode('longBreak')}
                                        className={`flex-1 py-2 rounded-xl text-sm transition-all ${
                                            mode === 'longBreak' ? 'bg-teal-500 text-white' : darkMode ? 'text-slate-300' : 'text-slate-700'
                                        }`}
                                    >
                                        Long Break
                                    </button>
                                </div>

                                <div className={`p-4 rounded-2xl ${darkMode ? 'bg-slate-800/50' : 'bg-white/50'} backdrop-blur-lg`}>
                                    <div className="flex items-center justify-between mb-3">
                                        <span className={`text-sm font-medium ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>
                                            {mode === 'focus' ? 'ðŸŽ¯ Focus Sound' : 'â˜• Break Sound'}
                                        </span>
                                        <button
                                            onClick={toggleSound}
                                            className={`p-2 rounded-lg transition-colors ${
                                                soundEnabled 
                                                    ? darkMode ? 'bg-purple-600 text-white' : 'bg-indigo-600 text-white'
                                                    : darkMode ? 'bg-slate-700 text-slate-400' : 'bg-slate-200 text-slate-600'
                                            }`}
                                        >
                                            {soundEnabled ? <Volume2 /> : <VolumeX />}
                                        </button>
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-2">
                                        {soundOptions.slice(0, 8).map(option => {
                                            const isSelected = mode === 'focus' 
                                                ? settings.focusSound === option.id 
                                                : settings.breakSound === option.id;
                                            const isLocked = !option.free && !isPremium;
                                            
                                            return (
                                                <button
                                                    key={option.id}
                                                    onClick={() => {
                                                        if (isLocked) {
                                                            setShowUpgradeModal(true);
                                                            return;
                                                        }
                                                        if (mode === 'focus') {
                                                            setSettings({...settings, focusSound: option.id});
                                                        } else {
                                                            setSettings({...settings, breakSound: option.id});
                                                        }
                                                        setSelectedSound(option.id);
                                                        setSoundEnabled(option.id !== 'none');
                                                    }}
                                                    className={`p-3 rounded-xl text-left transition-all relative ${
                                                        isSelected
                                                            ? darkMode 
                                                                ? 'bg-purple-600 text-white' 
                                                                : 'bg-indigo-600 text-white'
                                                            : darkMode
                                                                ? 'bg-slate-700/50 text-slate-300 hover:bg-slate-700'
                                                                : 'bg-white/50 text-slate-700 hover:bg-white/80'
                                                    } ${isLocked ? 'opacity-60' : ''}`}
                                                >
                                                    <div className="flex items-center justify-between">
                                                        <div className="text-xs font-medium truncate">{option.name}</div>
                                                        {isLocked && <span className="text-xs">ðŸ”’</span>}
                                                    </div>
                                                    <div className={`text-xs mt-0.5 truncate ${
                                                        isSelected 
                                                            ? 'text-white/70' 
                                                            : darkMode ? 'text-slate-500' : 'text-slate-500'
                                                    }`}>
                                                        {option.desc}
                                                    </div>
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>

                                {mode === 'focus' && settings.smartSuggestion && (
                                    <div className={`p-4 rounded-2xl ${darkMode ? 'bg-slate-800/50' : 'bg-white/50'} backdrop-blur-lg text-center`}>
                                        <p className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>
                                            ðŸ’¡ Suggested: {suggestion} min
                                        </p>
                                    </div>
                                )}

                                <div className={`p-12 rounded-3xl ${darkMode ? 'bg-slate-800/50' : 'bg-white/60'} backdrop-blur-lg shadow-2xl`}>
                                    <div className="text-center">
                                        <div className={`text-7xl font-light mb-6 ${darkMode ? 'text-white' : 'text-slate-800'} tracking-tight`}>
                                            {formatTime(timeLeft)}
                                        </div>
                                        
                                        {currentTask && (
                                            <div className={`mb-6 p-4 rounded-xl ${darkMode ? 'bg-slate-700/50' : 'bg-white/50'}`}>
                                                <p className={`text-sm ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>{currentTask}</p>
                                            </div>
                                        )}

                                        <div className="flex gap-4 justify-center">
                                            <button
                                                onClick={toggleTimer}
                                                className={`p-6 rounded-full ${
                                                    isActive 
                                                        ? 'bg-red-500 hover:bg-red-600' 
                                                        : darkMode ? 'bg-purple-600 hover:bg-purple-700' : 'bg-indigo-600 hover:bg-indigo-700'
                                                } text-white shadow-xl hover:scale-105 transition-transform`}
                                            >
                                                {isActive ? <Pause /> : <Play />}
                                            </button>
                                            
                                            <button
                                                onClick={resetTimer}
                                                className={`p-6 rounded-full ${darkMode ? 'bg-slate-700 hover:bg-slate-600' : 'bg-white hover:bg-gray-100'} ${darkMode ? 'text-white' : 'text-slate-700'} shadow-xl hover:scale-105 transition-transform`}
                                            >
                                                <RotateCcw />
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setShowTaskInput(true)}
                                        className={`flex-1 p-4 rounded-2xl ${darkMode ? 'bg-slate-800/50 text-white' : 'bg-white/60 text-slate-700'} backdrop-blur-lg flex items-center justify-center gap-2 hover:scale-105 transition-transform`}
                                    >
                                        <Plus />
                                        Set Task
                                    </button>
                                    
                                    <button
                                        onClick={() => setShowNoteInput(true)}
                                        className={`flex-1 p-4 rounded-2xl ${darkMode ? 'bg-slate-800/50 text-white' : 'bg-white/60 text-slate-700'} backdrop-blur-lg flex items-center justify-center gap-2 hover:scale-105 transition-transform`}
                                    >
                                        <Plus />
                                        Quick Note
                                    </button>
                                </div>

                                <div className={`p-6 rounded-2xl ${darkMode ? 'bg-slate-800/50' : 'bg-white/50'} backdrop-blur-lg`}>
                                    <div className="flex justify-around text-center">
                                        <div>
                                            <div className={`text-3xl font-bold ${darkMode ? 'text-white' : 'text-slate-800'}`}>{streak}</div>
                                            <div className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>Day Streak</div>
                                        </div>
                                        <div>
                                            <div className={`text-3xl font-bold ${darkMode ? 'text-white' : 'text-slate-800'}`}>{sessionCount}</div>
                                            <div className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>Today</div>
                                        </div>
                                        <div>
                                            <div className={`text-3xl font-bold ${darkMode ? 'text-white' : 'text-slate-800'}`}>{totalSessions}</div>
                                            <div className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>Total</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'analytics' && (
                            <div className="space-y-4">
                                <div className="flex items-center justify-between mb-6">
                                    <h2 className={`text-2xl font-light ${darkMode ? 'text-white' : 'text-slate-800'}`}>Your Progress</h2>
                                    {isPremium && (
                                        <span className="text-xs px-3 py-1 rounded-full bg-gradient-to-r from-indigo-500 to-purple-500 text-white">
                                            Premium
                                        </span>
                                    )}
                                </div>
                                
                                {!isPremium ? (
                                    <div className={`p-8 rounded-2xl ${darkMode ? 'bg-slate-800/50' : 'bg-white/60'} backdrop-blur-lg text-center`}>
                                        <div className="text-4xl mb-4">ðŸ“Š</div>
                                        <h3 className={`text-xl font-semibold mb-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>
                                            Unlock Analytics
                                        </h3>
                                        <p className={`text-sm mb-6 ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>
                                            Track your productivity, see trends, and optimize your focus time
                                        </p>
                                        <button
                                            onClick={() => setShowAuthModal(true)}
                                            className="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white hover:scale-105 transition-transform"
                                        >
                                            Upgrade to Premium
                                        </button>
                                    </div>
                                ) : (
                                    <>
                                        {[
                                            { label: 'Efficiency Rate', value: `${analytics.efficiency}%`, icon: <TrendingUp /> },
                                            { label: 'Total Focus Time', value: `${analytics.totalMinutes} min`, icon: <Calendar /> },
                                            { label: 'Weekly Forecast', value: `${analytics.weeklyForecast} min`, icon: <TrendingUp /> },
                                            { label: 'Best Time', value: analytics.bestTime, icon: <Award /> }
                                        ].map((stat, i) => (
                                            <div key={i} className={`p-6 rounded-2xl ${darkMode ? 'bg-slate-800/50' : 'bg-white/60'} backdrop-blur-lg flex items-center justify-between hover:scale-102 transition-transform`}>
                                                <div className="flex items-center gap-4">
                                                    <div className={`p-3 rounded-xl ${darkMode ? 'bg-purple-600/20 text-purple-400' : 'bg-indigo-100 text-indigo-600'}`}>
                                                        {stat.icon}
                                                    </div>
                                                    <div>
                                                        <div className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>{stat.label}</div>
                                                        <div className={`text-2xl font-bold ${darkMode ? 'text-white' : 'text-slate-800'}`}>{stat.value}</div>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </>
                                )}
                            </div>
                        )}

                        {view === 'settings' && (
                            <div className="space-y-4">
                                <h2 className={`text-2xl font-light mb-6 ${darkMode ? 'text-white' : 'text-slate-800'}`}>Settings</h2>
                                
                                <div className={`p-6 rounded-2xl ${darkMode ? 'bg-slate-800/50' : 'bg-white/60'} backdrop-blur-lg space-y-4`}>
                                    <div>
                                        <label className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'} mb-2 block`}>
                                            Focus Duration (minutes)
                                        </label>
                                        <input
                                            type="number"
                                            value={settings.focusDuration}
                                            onChange={(e) => setSettings({...settings, focusDuration: parseInt(e.target.value)})}
                                            className={`w-full p-3 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border-0 focus:ring-2 focus:ring-indigo-500`}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'} mb-2 block`}>
                                            Short Break (minutes)
                                        </label>
                                        <input
                                            type="number"
                                            value={settings.shortBreak}
                                            onChange={(e) => setSettings({...settings, shortBreak: parseInt(e.target.value)})}
                                            className={`w-full p-3 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border-0 focus:ring-2 focus:ring-indigo-500`}
                                        />
                                    </div>
                                    
                                    <div>
                                        <label className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'} mb-2 block`}>
                                            Long Break (minutes)
                                        </label>
                                        <input
                                            type="number"
                                            value={settings.longBreak}
                                            onChange={(e) => setSettings({...settings, longBreak: parseInt(e.target.value)})}
                                            className={`w-full p-3 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border-0 focus:ring-2 focus:ring-indigo-500`}
                                        />
                                    </div>

                                    <div className="pt-4 border-t border-slate-200 dark:border-slate-700">
                                        <label className={`text-sm font-medium ${darkMode ? 'text-slate-300' : 'text-slate-700'} mb-3 block`}>
                                            ðŸŽ¯ Focus Sound
                                        </label>
                                        <select
                                            value={settings.focusSound}
                                            onChange={(e) => setSettings({...settings, focusSound: e.target.value})}
                                            className={`w-full p-3 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border-0 focus:ring-2 focus:ring-indigo-500`}
                                        >
                                            {soundOptions.map(option => (
                                                <option key={option.id} value={option.id}>
                                                    {option.name} - {option.desc}
                                                </option>
                                            ))}
                                        </select>
                                    </div>

                                    <div>
                                        <label className={`text-sm font-medium ${darkMode ? 'text-slate-300' : 'text-slate-700'} mb-3 block`}>
                                            â˜• Break Sound
                                        </label>
                                        <select
                                            value={settings.breakSound}
                                            onChange={(e) => setSettings({...settings, breakSound: e.target.value})}
                                            className={`w-full p-3 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-white text-slate-800'} border-0 focus:ring-2 focus:ring-indigo-500`}
                                        >
                                            {soundOptions.map(option => (
                                                <option key={option.id} value={option.id}>
                                                    {option.name} - {option.desc}
                                                </option>
                                            ))}
                                        </select>
                                    </div>
                                    
                                    <div className="flex items-center justify-between pt-4 border-t border-slate-200 dark:border-slate-700">
                                        <span className={`text-sm ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>Smart Suggestions</span>
                                        <button
                                            onClick={() => setSettings({...settings, smartSuggestion: !settings.smartSuggestion})}
                                            className={`w-12 h-6 rounded-full transition-colors ${settings.smartSuggestion ? 'bg-indigo-600' : 'bg-slate-300'}`}
                                        >
                                            <div className={`w-5 h-5 bg-white rounded-full transform transition-transform ${settings.smartSuggestion ? 'translate-x-6' : 'translate-x-1'}`}></div>
                                        </button>
                                    </div>
                                    
                                    <div className="flex items-center justify-between">
                                        <span className={`text-sm ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>Soft Blocking</span>
                                        <button
                                            onClick={() => setSettings({...settings, softBlocking: !settings.softBlocking})}
                                            className={`w-12 h-6 rounded-full transition-colors ${settings.softBlocking ? 'bg-indigo-600' : 'bg-slate-300'}`}
                                        >
                                            <div className={`w-5 h-5 bg-white rounded-full transform transition-transform ${settings.softBlocking ? 'translate-x-6' : 'translate-x-1'}`}></div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showTaskInput && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-6">
                                <div className={`${darkMode ? 'bg-slate-800' : 'bg-white'} rounded-3xl p-8 max-w-sm w-full`}>
                                    <h3 className={`text-xl font-semibold mb-4 ${darkMode ? 'text-white' : 'text-slate-800'}`}>What are you working on?</h3>
                                    <input
                                        type="text"
                                        value={currentTask}
                                        onChange={(e) => setCurrentTask(e.target.value)}
                                        placeholder="e.g., Write report"
                                        className={`w-full p-4 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-slate-100 text-slate-800'} mb-4 focus:ring-2 focus:ring-indigo-500 border-0`}
                                        autoFocus
                                    />
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setShowTaskInput(false)}
                                            className={`flex-1 py-3 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-slate-200 text-slate-800'}`}
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={() => {
                                                setShowTaskInput(false);
                                                if (!isActive) setIsActive(true);
                                            }}
                                            className="flex-1 py-3 rounded-xl bg-indigo-600 text-white"
                                        >
                                            Start
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showNoteInput && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-6">
                                <div className={`${darkMode ? 'bg-slate-800' : 'bg-white'} rounded-3xl p-8 max-w-sm w-full`}>
                                    <h3 className={`text-xl font-semibold mb-4 ${darkMode ? 'text-white' : 'text-slate-800'}`}>Quick Note</h3>
                                    <textarea
                                        value={noteText}
                                        onChange={(e) => setNoteText(e.target.value)}
                                        placeholder="Capture a thought..."
                                        className={`w-full p-4 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-slate-100 text-slate-800'} mb-4 focus:ring-2 focus:ring-indigo-500 border-0 h-32`}
                                        autoFocus
                                    />
                                    <div className="flex gap-3">
                                        <button
                                            onClick={() => setShowNoteInput(false)}
                                            className={`flex-1 py-3 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-slate-200 text-slate-800'}`}
                                        >
                                            Cancel
                                        </button>
                                        <button
                                            onClick={addNote}
                                            className="flex-1 py-3 rounded-xl bg-indigo-600 text-white"
                                        >
                                            Save
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showUpgradeModal && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-6">
                                <div className={`${darkMode ? 'bg-slate-800' : 'bg-white'} rounded-3xl p-8 max-w-md w-full`}>
                                    <div className="text-center mb-6">
                                        <div className="text-5xl mb-4">ðŸŽ¯</div>
                                        <h3 className={`text-2xl font-semibold mb-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>
                                            Unlock Premium Features
                                        </h3>
                                        <p className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>
                                            Get access to all binaural beats and advanced analytics
                                        </p>
                                    </div>
                                    
                                    <div className={`p-6 rounded-2xl ${darkMode ? 'bg-slate-700/50' : 'bg-slate-50'} mb-6`}>
                                        <div className="space-y-3">
                                            <div className="flex items-center gap-3">
                                                <Check />
                                                <span className={`text-sm ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>
                                                    All binaural beats (Beta & Gamma)
                                                </span>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <Check />
                                                <span className={`text-sm ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>
                                                    Advanced analytics & insights
                                                </span>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <Check />
                                                <span className={`text-sm ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>
                                                    Goal tracking & milestones
                                                </span>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <Check />
                                                <span className={`text-sm ${darkMode ? 'text-slate-300' : 'text-slate-700'}`}>
                                                    Cloud sync across devices
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowUpgradeModal(false);
                                                setShowAuthModal(true);
                                            }}
                                            className="w-full py-4 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold hover:scale-105 transition-transform"
                                        >
                                            $4.99/month or $39/year
                                        </button>
                                        <button
                                            onClick={() => setShowUpgradeModal(false)}
                                            className={`w-full py-3 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-slate-200 text-slate-800'}`}
                                        >
                                            Maybe Later
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {showAuthModal && (
                            <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-6">
                                <div className={`${darkMode ? 'bg-slate-800' : 'bg-white'} rounded-3xl p-8 max-w-md w-full`}>
                                    <button
                                        onClick={() => setShowAuthModal(false)}
                                        className={`ml-auto block p-2 rounded-lg ${darkMode ? 'hover:bg-slate-700' : 'hover:bg-slate-100'}`}
                                    >
                                        <X />
                                    </button>
                                    
                                    <div className="text-center mb-6">
                                        <h3 className={`text-2xl font-semibold mb-2 ${darkMode ? 'text-white' : 'text-slate-800'}`}>
                                            Get Started with Premium
                                        </h3>
                                        <p className={`text-sm ${darkMode ? 'text-slate-400' : 'text-slate-600'}`}>
                                            Enter your email to continue
                                        </p>
                                    </div>
                                    
                                    <input
                                        type="email"
                                        value={authEmail}
                                        onChange={(e) => setAuthEmail(e.target.value)}
                                        placeholder="your@email.com"
                                        className={`w-full p-4 rounded-xl ${darkMode ? 'bg-slate-700 text-white' : 'bg-slate-100 text-slate-800'} mb-4 focus:ring-2 focus:ring-indigo-500 border-0`}
                                    />
                                    
                                    <button
                                        onClick={() => {
                                            setIsPremium(true);
                                            Backend.storage.user.isPremium = true;
                                            Backend.storage.user.email = authEmail;
                                            setShowAuthModal(false);
                                            alert('Welcome to Premium! ðŸŽ‰ (This is a demo)');
                                        }}
                                        className="w-full py-4 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 text-white font-semibold hover:scale-105 transition-transform mb-3"
                                    >
                                        Continue with Email
                                    </button>
                                    
                                    <div className={`text-center text-xs ${darkMode ? 'text-slate-500' : 'text-slate-500'}`}>
                                        We'll send you a magic link to sign in
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<UnWrk />, document.getElementById('root'));
    </script>
</body>
</html>
